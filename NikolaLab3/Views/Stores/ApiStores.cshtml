
@{
    ViewData["Title"] = "ApiStores";
}

<h2>ApiStores</h2>

<button type="button" onclick="getStores()">Get Stores</button>

<input type="text" id="query" placeholder="query" />

<br>

<table id="table">
    <tr>
        <th></th>
        <th></th>
        <th></th>
    </tr>
</table>

<script>
    function getStores() {

        var query = document.getElementById('query').value;

        if (query != '')
            query = '?query=' + query;

        var xhttp = new XMLHttpRequest();

        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                $('#table').empty();
                $('#table').append('<tr><th>Name</th><th>Id</th><th>First name</th></tr>');
                var i;
                var response = $.parseJSON(this.responseText);
                $(function () {
                    $.each(response, function (i, item) {
                        if (item.businessEntity && item.businessEntity.person) {
                            var $tr = $('<tr>').append(
                                $('<td>').text(item.name),
                                $('<td>').text(item.businessEntityId),
                                $('<td>').text(item.businessEntity.person.firstName)
                            ).appendTo('#table');
                        } else {
                            var $tr = $('<tr>').append(
                                $('<td>').text(item.name),
                                $('<td>').text(item.businessEntityId),
                                $('<td>').text("")
                            ).appendTo('#table');
                        }
                    });
                });
            }
        };

        xhttp.open("GET", "/api/Stores" + query, true);
        xhttp.send();
    }
</script>